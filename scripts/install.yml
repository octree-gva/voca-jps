jpsType: update
jpsVersion: '1.7.4'

name: Decidim/Install
id: decidim-vanilla-decidim-install
description:
  short: Install Decidim on a dummy environment
categories:
  - apps/platforms
baseUrl: https://raw.githubusercontent.com/octree-gva/voca-jps/main
logo: assets/decidim_logo.png
ssl: true
ha: false

onBeforeInit: /scripts/deploy/install-settings.js?_r=${fn.random}

onInstall:
  - setDisplayName
  - addEnvVars

actions:
  setDisplayName:
    - env.control.SetEnvDisplayName:
      displayName: "${settings.PUBLIC_URL}"
  addEnvVars:
    - env.control.AddContainerEnvVars[cp]:
      vars: {"TZ":"${settings.TIMEZONE}","DECIDIM_CURRENCY_UNIT":"${settings.DECIDIM_CURRENCY_UNIT}"}
    - env.control.AddContainerEnvVars[bl]:
      vars: {"PUBLIC_URL":"${settings.PUBLIC_URL}"}
    - env.control.RestartNodes[cp]

success: |
  The instance ${settings.PUBLIC_URL} is ready to be bound to ${env.envName}
startPage: ${settings.PUBLIC_URL}
